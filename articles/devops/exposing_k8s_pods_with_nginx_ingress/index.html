<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.78.0" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Exposing Pods in K8s with Nginx Ingress :: Not Applicable Doc</title>

    
    <link href="/css/nucleus.css?1605365142" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1605365142" rel="stylesheet">
    <link href="/css/hybrid.css?1605365142" rel="stylesheet">
    <link href="/css/featherlight.min.css?1605365142" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1605365142" rel="stylesheet">
    <link href="/css/auto-complete.css?1605365142" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1605365142" rel="stylesheet">
    <link href="/css/theme.css?1605365142" rel="stylesheet">
    <link href="/css/hugo-theme.css?1605365142" rel="stylesheet">
    
    <link href="/css/theme-green.css?1605365142" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1605365142"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/articles/devops/exposing_k8s_pods_with_nginx_ingress/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='/'>
  

  <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
  width="128" height="128"
  viewBox="0 0 26 26"
  style=" fill:#000000;"><path d="M 7 0 C 4.796875 0 3 1.796875 3 4 L 3 22 C 3 24.203125 4.796875 26 7 26 L 19 26 C 21.203125 26 23 24.203125 23 22 L 23 8 C 23 6.9375 22.027344 5.929688 20.28125 4.21875 C 20.039063 3.980469 19.777344 3.714844 19.53125 3.46875 C 19.285156 3.222656 19.019531 2.992188 18.78125 2.75 C 17.070313 1.003906 16.0625 0 15 0 Z M 7 2 L 14.28125 2 C 15.003906 2.183594 15 3.050781 15 3.9375 L 15 7 C 15 7.550781 15.449219 8 16 8 L 19 8 C 19.996094 8 21 8.003906 21 9 L 21 22 C 21 23.105469 20.105469 24 19 24 L 7 24 C 5.894531 24 5 23.105469 5 22 L 5 4 C 5 2.894531 5.894531 2 7 2 Z M 7.8125 10 C 7.261719 10.050781 6.855469 10.542969 6.90625 11.09375 C 6.957031 11.644531 7.449219 12.050781 8 12 L 18 12 C 18.359375 12.003906 18.695313 11.816406 18.878906 11.503906 C 19.058594 11.191406 19.058594 10.808594 18.878906 10.496094 C 18.695313 10.183594 18.359375 9.996094 18 10 L 8 10 C 7.96875 10 7.9375 10 7.90625 10 C 7.875 10 7.84375 10 7.8125 10 Z M 7.8125 14 C 7.261719 14.050781 6.855469 14.542969 6.90625 15.09375 C 6.957031 15.644531 7.449219 16.050781 8 16 L 16 16 C 16.359375 16.003906 16.695313 15.816406 16.878906 15.503906 C 17.058594 15.191406 17.058594 14.808594 16.878906 14.496094 C 16.695313 14.183594 16.359375 13.996094 16 14 L 8 14 C 7.96875 14 7.9375 14 7.90625 14 C 7.875 14 7.84375 14 7.8125 14 Z M 7.8125 18 C 7.261719 18.050781 6.855469 18.542969 6.90625 19.09375 C 6.957031 19.644531 7.449219 20.050781 8 20 L 18 20 C 18.359375 20.003906 18.695313 19.816406 18.878906 19.503906 C 19.058594 19.191406 19.058594 18.808594 18.878906 18.496094 C 18.695313 18.183594 18.359375 17.996094 18 18 L 8 18 C 7.96875 18 7.9375 18 7.90625 18 C 7.875 18 7.84375 18 7.8125 18 Z"></path></svg>



</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1605365142"></script>
<script type="text/javascript" src="/js/auto-complete.js?1605365142"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/doc.notapplicable.info";
    
</script>
<script type="text/javascript" src="/js/search.js?1605365142"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/getting-started/" title="Cloning editing and re-using this site and its templates" class="dd-item
        
        
        
        ">
      <a href="/getting-started/">
          <b>1. </b>Cloning editing and re-using this site and its templates
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/getting-started/editting_files/" title="Editing files" class="dd-item ">
        <a href="/getting-started/editting_files/">
        Editing files
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/getting-started/cloning_this_repository_and_regenerating_the_site_locally/" title="Cloning this site and regenerating locally on your own machine" class="dd-item ">
        <a href="/getting-started/cloning_this_repository_and_regenerating_the_site_locally/">
        Cloning this site and regenerating locally on your own machine
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/getting-started/installation/" title="Installation" class="dd-item ">
        <a href="/getting-started/installation/">
        Installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/getting-started/publishing-a-hugo-site-to-github-io/" title="Publishing a Hugo Site to Github Io" class="dd-item ">
        <a href="/getting-started/publishing-a-hugo-site-to-github-io/">
        Publishing a Hugo Site to Github Io
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/articles/" title="Articles" class="dd-item
        parent
        
        
        ">
      <a href="/articles/">
          <b>2. </b>Articles
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/articles/devops/" title="Devops" class="dd-item
        parent
        
        
        ">
      <a href="/articles/devops/">
          <b>2.1. </b>Devops
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/articles/devops/deploying_containers_on_single_node_docker_with_compose/" title="Deploying containers on single node docker nodes with compose" class="dd-item ">
        <a href="/articles/devops/deploying_containers_on_single_node_docker_with_compose/">
        Deploying containers on single node docker nodes with compose
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/articles/devops/exposing_k8s_pods_with_nginx_ingress/" title="Exposing Pods in K8s with Nginx Ingress" class="dd-item active">
        <a href="/articles/devops/exposing_k8s_pods_with_nginx_ingress/">
        Exposing Pods in K8s with Nginx Ingress
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/articles/devops/exposing_k8s_pods_to_the_outside/" title="Exposing Pods in K8s to the outside world" class="dd-item ">
        <a href="/articles/devops/exposing_k8s_pods_to_the_outside/">
        Exposing Pods in K8s to the outside world
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/articles/devops/deploying_kubernetes_clusters_with_different_cloud_providers/" title="Deploying Kubernetes Clusters to Cloud Providers" class="dd-item ">
        <a href="/articles/devops/deploying_kubernetes_clusters_with_different_cloud_providers/">
        Deploying Kubernetes Clusters to Cloud Providers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/articles/devops/deploy-a-go-web-service-as-an-azure-web-application-using-docker/" title="Deploy a Go Web Service as an Azure Web Application Using Docker" class="dd-item ">
        <a href="/articles/devops/deploy-a-go-web-service-as-an-azure-web-application-using-docker/">
        Deploy a Go Web Service as an Azure Web Application Using Docker
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Home</a> > <a href='/articles/'>Articles</a> > <a href='/articles/devops/'>Devops</a> > Exposing Pods in K8s with Nginx Ingress
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#creating-a-test-back-end-service">Creating a test back-end service</a></li>
        <li><a href="#setting-up-nginx-ingress-controller">Setting Up Nginx Ingress Controller</a></li>
        <li><a href="#ingress-configuration">Ingress configuration</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Exposing Pods in K8s with Nginx Ingress
            </h1>
          

        


<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>A working K8s cluster</li>
<li>Kubectl</li>
</ul>
<p>see <a href="/articles/devops/deploying_kubernetes_clusters_with_different_cloud_providers">this article</a></p>
<h3 id="creating-a-test-back-end-service">Creating a test back-end service</h3>
<p>A <code>deployment</code> and <code>service</code> needs to be implemented to create :</p>
<ul>
<li>
<p>a pod with an application in this case called <code>marshyon/test-node-listener</code> - see <a href="https://github.com/marshyon/test-node-listener">this repo</a> for the code behind this</p>
</li>
<li>
<p>a service of type <code>ClusterIP </code>, the default if not specified and by its nature only available internally within the K8s cluster</p>
</li>
</ul>
<blockquote>
<p>The latter is important to note as if this were to be of type <code>LoadBalancer</code>, the service would be exposed by the underlying cloud fabric and this would be a 1:1 relationship in that for every <code>service</code> of type <code>LoadBalancer</code> there would be a separate load balancer and external IP address created. With large or complicated applications this could quickly become unwieldy. By deploying an ingress controller, a <em><strong>single load balancer</strong></em> is created that can distribute requests to different back end services by host name and or urls.</p>
</blockquote>
<p>Here is a manifest file for a deployment and service - <code>post.yaml</code> :</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: post1
spec:
  ports:
  - port: 80
    targetPort: 4000
  selector:
    app: post1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: post1
spec:
  selector:
    matchLabels:
      app: post1
  replicas: 2
  template:
    metadata:
      labels:
        app: post1
    spec:
      containers:
      - name: post1
        image: marshyon/test-node-listener
        args:
        - &quot;-text=post1&quot;
        ports:
        - containerPort: 4000
</code></pre><p>it is applied with :</p>
<pre><code>kubectl apply -f .\post1.yaml
</code></pre><p>the deployment can be seen to be running with :</p>
<pre><code>kubectl.exe get deployments
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
post1   2/2     2            2           15m
</code></pre><p>running pods :</p>
<pre><code>kubectl get pods
NAME                     READY   STATUS    RESTARTS   AGE
post1-68fb864b7d-4clbh   1/1     Running   0          6m42s
post1-68fb864b7d-msz2x   1/1     Running   0          6m42s
</code></pre><h3 id="setting-up-nginx-ingress-controller">Setting Up Nginx Ingress Controller</h3>
<p>Kubernetes has standard deployments for popular Cloud providers, at time of writing this includes Amazon, Azure, Google, Digital Ocean and Scaleway. For specific deployments see <a href="https://kubernetes.github.io/ingress-nginx/deploy">https://kubernetes.github.io/ingress-nginx/deploy</a></p>
<p>The following is for Digital Ocean :</p>
<pre><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.41.2/deploy/static/provider/do/deploy.yaml
</code></pre><p>Taking a look at the <a href="https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.41.2/deploy/static/provider/do/deploy.yaml">url</a> there are a number of manifests each separated by <code>---</code> character breaks and consisting of 10 kinds :</p>
<pre><code>curl -s https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.41.2/deploy/static/provider/do/deploy.yaml | egrep &quot;^kind: &quot; | cut -f2 -d' ' | grep -v Namespace | sort | uniq
ClusterRole
ClusterRoleBinding
ConfigMap
Deployment
Job
Role
RoleBinding
Service
ServiceAccount
ValidatingWebhookConfiguration
</code></pre><p>it is worth reviewing these as there are 17 in total :</p>
<pre><code>curl -s https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.41.2/deploy/static/provider/do/deploy.yaml | egrep &quot;^kind: &quot; | cut -f2 -d' ' | grep -v Namespace | sort | wc -l
17
</code></pre><p>and this can offer insight into how complex services are deployed in K8s and can also serve to inform how such ingress deployments may be crafted to suit applications for different applications and clients.</p>
<h3 id="ingress-configuration">Ingress configuration</h3>
<p>To this point all of the infrastructure has been implemented but there is no exposure of the running service to the world outside of K8s.</p>
<p>The ingress configuration file : <code>ingress.yaml</code></p>
<pre><code>apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: post-ingress
spec:
  rules:
  - host: post1.notapplicable.info
    http:
      paths:
      - backend:
          serviceName: post1
          servicePort: 80  
</code></pre><p>is applied with :</p>
<pre><code>kubectl apply -f .\ingress.yaml
</code></pre><p>its status is obtained from :</p>
<pre><code>kubectl get ingress
Warning: extensions/v1beta1 Ingress is deprecated in v1.14+, unavailable in v1.22+; use networking.k8s.io/v1 Ingress
NAME           CLASS    HOSTS                                                                        ADDRESS           PORTS   AGE
echo-ingress   &lt;none&gt;   post1.notapplicable.info   206.189.245.136   80      79m
</code></pre><p>Here the ip address <code>206.189.245.136</code> is created by the underlying <code>Digital Ocean</code> infrastructure.</p>
<p>A final step, entirely outside of K8s is required to create a <code>DNS A record</code> of <code>post1.notapplicable.info</code> ( replacing post1.notapplicable.info with the domain name that you own ) and resolving to the IP address in your ingress configuration.</p>


<div id="remark42"></div>

<footer class="footline">
	
</footer>

        
        </div>
        <script>
    var remark_config = {
      host: "https://remark42.notapplicable.info", 
      
      components: ['embed'], 
      max_shown_comments: 10, 
      locale: 'en', 
      show_email_subscription: false 
    };
  
    (function(c) {
      for(var i = 0; i < c.length; i++){
        var d = document, s = d.createElement('script');
        s.src = remark_config.host + '/web/' +c[i] +'.js';
        s.defer = true;
        (d.head || d.body).appendChild(s);
      }
    })(remark_config.components || ['embed']);
  </script>
      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/articles/devops/deploying_containers_on_single_node_docker_with_compose/" title="Deploying containers on single node docker nodes with compose"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/articles/devops/exposing_k8s_pods_to_the_outside/" title="Exposing Pods in K8s to the outside world" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1605365142"></script>
    <script src="/js/perfect-scrollbar.min.js?1605365142"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1605365142"></script>
    <script src="/js/jquery.sticky.js?1605365142"></script>
    <script src="/js/featherlight.min.js?1605365142"></script>
    <script src="/js/highlight.pack.js?1605365142"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1605365142"></script>
    <script src="/js/learn.js?1605365142"></script>
    <script src="/js/hugo-learn.js?1605365142"></script>
    
        
            <script src="/mermaid/mermaid.js?1605365142"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

